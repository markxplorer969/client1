import{d as M,G as z,r,k as q,c as a,b as l,w as k,j as P,y as s,z as m,H as A,I as J,t as U,n as L,J as D,F as K,m as W,v as Q,E as X,o as n}from"./a6n2H657.js";import{S as V}from"./BQIkj5Wb.js";const Y={class:"container px-3 mb-4"},Z={class:"content-card p-3 p-md-4"},ee={class:"row g-4"},le={class:"col-md-7"},te={class:"mb-3"},ie={class:"mb-3"},oe={class:"editor-toolbar"},ae={class:"row"},ne={class:"col-sm-6 mb-3"},se={class:"col-sm-6 mb-3"},re={class:"mb-3"},de={class:"col-md-5 d-flex flex-column"},ue={key:0,class:"image-preview-container mb-2"},pe=["src"],ce={key:0},me=["title"],be={key:1},fe={class:"mb-4"},ve={class:"nav nav-tabs mb-3"},ge={class:"nav-item"},ke={class:"nav-item"},ye={class:"tab-content border-0"},xe={key:0},Ce={class:"mb-3"},Pe={class:"form-check form-check-inline"},we={class:"form-check form-check-inline"},Ue={key:0},_e=["title"],Se={key:1},Te={key:1},Ie={class:"mb-4"},Fe={class:"col"},Le=["onUpdate:modelValue"],De={class:"col-auto"},Ve=["onClick"],Be={class:"d-flex justify-content-end"},$e=["disabled"],je={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ne={key:1},he={key:0,class:"alert alert-danger mt-3"},Me=M({__name:"add-product",setup(Ge){const t=z({name:"",description:"",price:null,originalPrice:null,badge:"",image:null,additional_information:[],file:null}),d=r("upload"),b=r("local"),y=r(null),f=r(!1),v=r(null),u=r(null),x=r(null),_=r(null);X();const{$api:B}=q(),S=o=>{d.value=o,t.file=null,w()},$=()=>y.value?.click(),j=o=>{const i=o.target.files?.[0]||null;i&&(t.file=i)},w=()=>{t.file=null,y.value&&(y.value.value="")},N=()=>t.additional_information.push({name:""}),h=o=>t.additional_information.splice(o,1),G=()=>x.value?.click(),T=o=>{o&&o.type.startsWith("image/")&&(t.image=o,u.value=URL.createObjectURL(o))},O=o=>T(o.target.files?.[0]||null),R=o=>T(o.dataTransfer?.files[0]||null),I=()=>{t.image=null,u.value&&URL.revokeObjectURL(u.value),u.value=null,x.value&&(x.value.value="")},C=o=>{const e=_.value;if(!e)return;const i=e.selectionStart,p=e.selectionEnd,c=e.value.substring(i,p);let g="";switch(o){case"bold":g=`**${c}**`;break;case"italic":g=`*${c}*`;break;case"heading":const F=e.value.lastIndexOf(`
`,i-1)+1;g=`## ${e.value.substring(F,p)}`,e.setSelectionRange(F,p);break;case"list":g=c.split(`
`).map(E=>`- ${E}`).join(`
`);break}e.setRangeText(g,e.selectionStart,e.selectionEnd,"end"),t.description=e.value,e.focus()},H=async()=>{if(f.value=!0,v.value=null,!t.name||!t.price||!t.image){v.value="Nama, harga, dan gambar produk wajib diisi.",f.value=!1;return}const o=new FormData;o.append("name",t.name),o.append("description",t.description),o.append("price",String(t.price)),t.originalPrice&&o.append("original_price",String(t.originalPrice)),t.badge&&o.append("badge",t.badge),o.append("image",t.image),o.append("type","add");const e=t.additional_information.filter(i=>i.name.trim());e.length>0&&o.append("additional_information",JSON.stringify(e)),t.file&&(d.value==="upload"&&typeof t.file=="object"?(o.append("file",t.file),o.append("file_upload_destination",b.value)):d.value==="url"&&typeof t.file=="string"&&o.append("file_url",t.file));try{const i=await B("/api/v2/product",{method:"POST",body:o});if(Object.assign(t,{name:"",description:"",price:null,originalPrice:null,badge:"",image:null,additional_information:[],file:null}),I(),w(),!i.data?._id)throw new Error(i.msg);await V.fire({icon:"success",title:"Berhasil!",text:"Produk telah ditambahkan.",timer:2e3,showConfirmButton:!1})}catch(i){v.value=i.data?.msg||"Gagal menambahkan produk. Silakan coba lagi.",V.fire({icon:"error",title:"Gagal",text:`Terjadi kesalahan: ${i.message}`})}finally{f.value=!1}};return(o,e)=>(n(),a("div",Y,[l("div",Z,[l("form",{onSubmit:k(H,["prevent"])},[l("div",ee,[l("div",le,[l("div",te,[e[15]||(e[15]=l("label",{for:"productName",class:"form-label"},"Nama Produk",-1)),s(l("input",{type:"text",class:"form-control",id:"productName","onUpdate:modelValue":e[0]||(e[0]=i=>t.name=i),required:""},null,512),[[m,t.name]])]),l("div",ie,[e[20]||(e[20]=l("label",{for:"productDescription",class:"form-label"},"Deskripsi (Markdown)",-1)),l("div",oe,[l("button",{type:"button",onClick:e[1]||(e[1]=i=>C("bold")),title:"Bold (Ctrl+B)"},e[16]||(e[16]=[l("i",{class:"bi bi-type-bold"},null,-1)])),l("button",{type:"button",onClick:e[2]||(e[2]=i=>C("italic")),title:"Italic (Ctrl+I)"},e[17]||(e[17]=[l("i",{class:"bi bi-type-italic"},null,-1)])),l("button",{type:"button",onClick:e[3]||(e[3]=i=>C("heading")),title:"Heading"},e[18]||(e[18]=[l("i",{class:"bi bi-type-h2"},null,-1)])),l("button",{type:"button",onClick:e[4]||(e[4]=i=>C("list")),title:"Unordered List"},e[19]||(e[19]=[l("i",{class:"bi bi-list-ul"},null,-1)]))]),s(l("textarea",{class:"form-control editor-textarea",id:"productDescription",rows:"8","onUpdate:modelValue":e[5]||(e[5]=i=>t.description=i),ref_key:"descriptionTextarea",ref:_},null,512),[[m,t.description]])]),l("div",ae,[l("div",ne,[e[21]||(e[21]=l("label",{for:"productPrice",class:"form-label"},"Harga",-1)),s(l("input",{type:"number",class:"form-control",id:"productPrice","onUpdate:modelValue":e[6]||(e[6]=i=>t.price=i),required:""},null,512),[[m,t.price]])]),l("div",se,[e[22]||(e[22]=l("label",{for:"originalPrice",class:"form-label"},"Harga Asli (Opsional)",-1)),s(l("input",{type:"number",class:"form-control",id:"originalPrice","onUpdate:modelValue":e[7]||(e[7]=i=>t.originalPrice=i),placeholder:"Contoh: 500000"},null,512),[[m,t.originalPrice]])])]),l("div",re,[e[24]||(e[24]=l("label",{for:"productBadge",class:"form-label"},"Badge/Label (Opsional)",-1)),s(l("select",{class:"form-select",id:"productBadge","onUpdate:modelValue":e[8]||(e[8]=i=>t.badge=i)},e[23]||(e[23]=[J('<option value="">-- Tidak ada badge --</option><option value="Baru">Baru</option><option value="Populer">Populer</option><option value="Diskon">Diskon</option><option value="Hot Item">Hot Item</option>',5)]),512),[[A,t.badge]])])]),l("div",de,[e[27]||(e[27]=l("label",{class:"form-label"},"Gambar Produk",-1)),u.value?(n(),a("div",ue,[l("img",{src:u.value,alt:"Preview Gambar Produk",class:"img-preview"},null,8,pe)])):P("",!0),l("div",{class:"image-upload-box text-center",onClick:G,onDragover:e[9]||(e[9]=k(()=>{},["prevent"])),onDrop:k(R,["prevent"])},[t.image?(n(),a("div",ce,[e[25]||(e[25]=l("i",{class:"bi bi-file-earmark-image-fill upload-icon text-success"},null,-1)),l("p",{class:"mb-0 text-truncate px-2",title:t.image.name},U(t.image.name),9,me),l("button",{type:"button",class:"btn btn-sm btn-outline-danger mt-2",onClick:k(I,["stop"])},"Ganti Gambar")])):(n(),a("div",be,e[26]||(e[26]=[l("i",{class:"bi bi-cloud-arrow-up-fill upload-icon"},null,-1),l("p",{class:"text-secondary small"},"Klik atau seret gambar ke sini",-1)])))],32),l("input",{type:"file",ref_key:"fileInput",ref:x,onChange:O,accept:"image/*",class:"d-none"},null,544)])]),e[40]||(e[40]=l("hr",{class:"my-4"},null,-1)),l("div",fe,[e[34]||(e[34]=l("h5",{class:"mb-3"},"File Produk (Opsional)",-1)),e[35]||(e[35]=l("p",{class:"small"},"Sediakan file digital yang akan diterima pembeli. Bisa berupa file upload atau link eksternal.",-1)),l("ul",ve,[l("li",ge,[l("button",{class:L(["nav-link",{active:d.value==="upload"}]),type:"button",onClick:e[10]||(e[10]=i=>S("upload"))},"Upload File",2)]),l("li",ke,[l("button",{class:L(["nav-link",{active:d.value==="url"}]),type:"button",onClick:e[11]||(e[11]=i=>S("url"))},"Gunakan URL",2)])]),l("div",ye,[d.value==="upload"?(n(),a("div",xe,[l("div",Ce,[e[30]||(e[30]=l("label",{class:"form-label small"},"Tujuan Upload : Â ",-1)),l("div",Pe,[s(l("input",{class:"form-check-input",type:"radio",id:"uploadLocal",value:"local","onUpdate:modelValue":e[12]||(e[12]=i=>b.value=i)},null,512),[[D,b.value]]),e[28]||(e[28]=l("label",{class:"form-check-label",for:"uploadLocal"},"Local",-1))]),l("div",we,[s(l("input",{class:"form-check-input",type:"radio",id:"uploadCloud",value:"cloud","onUpdate:modelValue":e[13]||(e[13]=i=>b.value=i)},null,512),[[D,b.value]]),e[29]||(e[29]=l("label",{class:"form-check-label",for:"uploadCloud"},"Cloud",-1))])]),l("div",{class:"image-upload-box text-center",onClick:$},[t.file&&typeof t.file=="object"?(n(),a("div",Ue,[e[31]||(e[31]=l("i",{class:"bi bi-file-zip-fill upload-icon text-success"},null,-1)),l("p",{class:"mb-0 text-truncate px-2",title:t.file.name},U(t.file.name),9,_e),l("button",{type:"button",class:"btn btn-sm btn-outline-danger mt-2",onClick:k(w,["stop"])},"Ganti File")])):(n(),a("div",Se,e[32]||(e[32]=[l("i",{class:"bi bi-cloud-arrow-up-fill upload-icon"},null,-1),l("p",{class:"text-secondary small"},"Klik atau seret file ke sini",-1)])))]),l("input",{type:"file",ref_key:"productFileInput",ref:y,onChange:j,class:"d-none"},null,544)])):P("",!0),d.value==="url"?(n(),a("div",Te,[e[33]||(e[33]=l("label",{for:"fileUrl",class:"form-label"},"Link File Produk",-1)),s(l("input",{type:"url",class:"form-control",id:"fileUrl","onUpdate:modelValue":e[14]||(e[14]=i=>t.file=i),placeholder:"https://contoh.com/file-produk.zip"},null,512),[[m,t.file]])])):P("",!0)])]),l("div",Ie,[e[38]||(e[38]=l("h5",{class:"mb-3"},"Informasi Tambahan dari Pembeli",-1)),e[39]||(e[39]=l("p",{class:"small"},"Tentukan label input yang harus diisi oleh pembeli.",-1)),(n(!0),a(K,null,W(t.additional_information,(i,p)=>(n(),a("div",{key:p,class:"row g-2 mb-2 align-items-center"},[l("div",Fe,[s(l("input",{type:"text",class:"form-control","onUpdate:modelValue":c=>i.name=c,placeholder:"Nama Label (Contoh: ID Game)"},null,8,Le),[[m,i.name]])]),l("div",De,[l("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:c=>h(p),title:"Hapus Label"},e[36]||(e[36]=[l("i",{class:"bi bi-trash"},null,-1)]),8,Ve)])]))),128)),l("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:N},e[37]||(e[37]=[l("i",{class:"bi bi-plus-circle"},null,-1),Q(" Tambah Label",-1)]))]),l("div",Be,[l("button",{type:"submit",class:"btn btn-custom-accent btn-lg",disabled:f.value},[f.value?(n(),a("span",je)):(n(),a("span",Ne,"Simpan Produk"))],8,$e)]),v.value?(n(),a("div",he,U(v.value),1)):P("",!0)],32)])]))}});export{Me as default};
