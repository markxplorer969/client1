import{M as S,_ as N}from"./3urowaeH.js";import{d as T,k as B,r as f,x as C,i as w,c as i,b as e,j as x,t as l,f as m,F as D,m as L,w as V,h as A,o as n,y as H,z as F,p as P,q as j,l as E,u as U,A as q,B as G,e as I,v as O}from"./a6n2H657.js";import{f as v}from"./Dh1ThmVH.js";import{S as k}from"./BQIkj5Wb.js";const R={class:"content-card p-3 p-md-4"},z={class:"mb-4"},J={class:"final-price mb-1"},W={key:0,class:"original-price-wrapper"},K={class:"original-price text-secondary"},Q={key:0,class:"mb-3"},X=["for"],Y=["id","onUpdate:modelValue","placeholder"],Z={class:"payment-details mb-3"},tt={class:"detail-row"},et={class:"detail-row"},at={class:"total-row mb-4"},st={class:"total-amount"},ot={key:0,class:"stock-status text-success mb-3"},nt={key:1,class:"stock-status text-danger mb-3"},it={class:"d-flex align-items-center gap-2"},rt=["disabled"],lt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ct={key:1},dt={key:2},ut=T({__name:"BuyCard",props:{product:{}},setup($){const _=A(),{$api:g}=B(),u=$,c=f(!1),s=f([]),p=()=>{window.location.href=_.public.contacts[0].url};C(()=>u.product,a=>{if(s.value=[],a?.additional_information&&typeof a.additional_information=="string")try{const t=JSON.parse(a.additional_information);Array.isArray(t)&&(s.value=t.map(o=>({name:o.name,value:""})))}catch(t){console.error("Gagal mem-parsing additional_information:",t)}},{immediate:!0,deep:!0});const d=(a,t)=>{const o=a*(t/100);return{tax:Number(Math.round(o)?.toFixed(0)),total:a+o}},b=w(()=>d(u.product.price,_.public.tax).tax),r=w(()=>Number(u.product.price)+Number(b.value)),h=async a=>{if(!u.product.stock_available){k.fire({icon:"error",text:"Maaf, stok produk ini telah habis."});return}for(const t of s.value)if(!t.value.trim()){k.fire({icon:"warning",text:`Harap isi kolom "${t.name}" terlebih dahulu.`});return}c.value=!0;try{const t=await g("/api/v1/checkout",{method:"POST",body:{item:a,additional_information:s.value}});if(!t.status)throw new Error(t.msg);s.value.forEach(o=>o.value=""),await P(t.data.redirect)}catch(t){const o=t?.data?.msg||"Terjadi kesalahan yang tidak diketahui. Silakan coba lagi.";k.fire({icon:"error",text:o})}finally{c.value=!1}};return(a,t)=>(n(),i("div",R,[e("div",z,[e("h3",J,l(m(v)(a.product.price)),1),a.product.original_price?(n(),i("div",W,[t[1]||(t[1]=e("span",{class:"text-secondary"},"Diskon",-1)),e("span",K,l(m(v)(a.product.original_price)),1)])):x("",!0)]),e("form",{id:"purchase-form",onSubmit:t[0]||(t[0]=V(o=>h(a.product._id),["prevent"]))},[s.value.length?(n(),i("div",Q,[t[2]||(t[2]=e("h5",{class:"form-section-title"},"Lengkapi Data Pesanan",-1)),(n(!0),i(D,null,L(s.value,(o,y)=>(n(),i("div",{key:y,class:"mb-3"},[e("label",{for:`info-${y}`,class:"form-label small"},l(o.name),9,X),H(e("input",{type:"text",class:"form-control",id:`info-${y}`,"onUpdate:modelValue":M=>o.value=M,placeholder:`Masukkan ${o.name}`,required:""},null,8,Y),[[F,o.value]])]))),128))])):x("",!0)],32),e("div",Z,[e("div",tt,[t[3]||(t[3]=e("span",{class:"label"},"Harga Produk",-1)),e("span",null,l(m(v)(a.product.price)),1)]),e("div",et,[t[4]||(t[4]=e("span",{class:"label"},"Biaya Penanganan",-1)),e("span",null,l(m(v)(b.value)),1)])]),t[9]||(t[9]=e("hr",{class:"my-3"},null,-1)),e("div",at,[t[5]||(t[5]=e("span",null,"Total",-1)),e("span",st,l(m(v)(r.value)),1)]),a.product.stock_available?(n(),i("div",ot,t[6]||(t[6]=[e("i",{class:"bi bi-check-circle-fill me-2"},null,-1),e("span",null,"Stok Tersedia",-1)]))):(n(),i("div",nt,t[7]||(t[7]=[e("i",{class:"bi bi-x-circle-fill me-2"},null,-1),e("span",null,"Stok Tidak Tersedia",-1)]))),e("div",it,[e("button",{class:"btn btn-secondary btn-icon",onClick:p},t[8]||(t[8]=[e("i",{class:"bi bi-whatsapp"},null,-1)])),e("button",{type:"submit",form:"purchase-form",disabled:c.value||!a.product.stock_available,class:"btn btn-custom-accent btn-lg flex-grow-1 d-flex justify-content-center align-items-center",style:{"min-height":"48px"}},[c.value?(n(),i("span",lt)):a.product.stock_available?(n(),i("span",dt,"Beli")):(n(),i("span",ct,"Stok Habis"))],8,rt)])]))}}),pt={class:"container px-3 mb-4"},mt={key:0,class:"d-flex justify-content-center align-items-center py-5"},vt={key:2,class:"row g-4"},ft={class:"col-lg-8"},_t={class:"content-card p-3 p-md-4"},bt=["src","alt"],ht={class:"mb-3"},gt=["innerHTML"],yt={class:"col-lg-4 buy-card-sidebar"},Tt=T({__name:"[id]",setup($){const{$api:_}=B(),g=new S,c=j().params.id,s=f(null),p=f(!0),d=f(null),b=w(()=>s.value?.description?g.render(s.value.description):"");return E(async()=>{p.value=!0,d.value=null;try{const r=await _(`/api/v1/products?id=${c}`);if(!r.status)throw new Error(r.msg);s.value=r.data,U({title:r.data.name})}catch(r){d.value=r.message}finally{p.value=!1}}),(r,h)=>{const a=N,t=ut;return n(),i("div",null,[e("div",pt,[p.value?(n(),i("div",mt,h[0]||(h[0]=[e("div",{class:"spinner-border product-loader-spinner",role:"status"},null,-1),e("p",{class:"ms-3 mb-0"},"Loading...",-1)]))):d.value?(n(),q(a,{key:1,type:"danger"},{default:G(()=>[O(l(d.value),1)]),_:1})):s.value?(n(),i("div",vt,[e("div",ft,[e("div",_t,[e("img",{src:s.value.imageUrl||"https://via.placeholder.com/800x600.png?text=Gambar+Produk",alt:s.value.name,class:"img-fluid rounded mb-4"},null,8,bt),e("h1",ht,l(s.value.name),1),e("div",{class:"text-secondary product-description",innerHTML:b.value},null,8,gt)])]),e("div",yt,[I(t,{product:s.value},null,8,["product"])])])):x("",!0)])])}}});export{Tt as default};
