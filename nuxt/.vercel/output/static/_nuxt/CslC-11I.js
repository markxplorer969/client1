import{d as Q,k as X,u as Y,G as Z,r as n,q as tt,l as et,E as lt,c as o,j as h,b as e,y as r,z as f,H as N,K as it,t as w,w as k,n as O,J as j,F as at,m as ot,v as st,o as s}from"./a6n2H657.js";import{S}from"./BQIkj5Wb.js";const nt={class:"container px-3 mb-4"},rt={key:0,class:"d-flex justify-content-center align-items-center py-5"},dt={key:1,class:"content-card p-3 p-md-4"},ut={class:"row g-4"},pt={class:"col-md-7"},ct={class:"mb-3"},mt={class:"mb-3"},bt={class:"editor-toolbar"},vt={class:"row"},ft={class:"col-sm-6 mb-3"},kt={class:"col-sm-6 mb-3"},gt={class:"col-sm-6 mb-3"},yt={class:"col-sm-6 mb-3"},xt={class:"mb-3"},wt={class:"form-check form-switch"},_t={class:"form-check-label",for:"stockSwitch"},Ct={class:"col-md-5 d-flex flex-column"},Tt={key:0,class:"image-preview-container mb-2"},ht=["src"],St={key:0},Ut=["title"],Ft={key:1},It={class:"mb-4"},Pt={class:"nav nav-tabs mb-3"},Vt={class:"nav-item"},Dt={class:"nav-item"},Lt={class:"tab-content border-0"},$t={key:0},Gt={class:"mb-3"},Nt={class:"form-check form-check-inline"},Ot={class:"form-check form-check-inline"},jt={key:0},Bt=["title"],Ht={key:1},Mt=["title"],Rt={class:"small text-muted mb-0"},Et={key:2},zt={key:1},Kt={class:"mb-4"},qt={class:"col"},At=["onUpdate:modelValue"],Jt={class:"col-auto"},Wt=["onClick"],Qt={class:"d-flex justify-content-end"},Xt=["disabled"],Yt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Zt={key:1},oe=Q({__name:"[id]",setup(te){const{$api:F}=X();Y({title:"Edit Produk"});const l=Z({additional_information:[]}),I=n(!0),g=n(!1),m=n(null),_=n(null),P=n(null),d=n(null),p=n(null),c=n(""),u=n("upload"),y=n("local"),C=n(null),U=tt(),B=lt(),V=Array.isArray(U.params.id)?U.params.id[0]:U.params.id,H=()=>l.additional_information?.push({name:""}),M=i=>l.additional_information?.splice(i,1),R=()=>_.value?.click(),D=i=>{i&&i.type.startsWith("image/")&&(l.image=i,m.value=URL.createObjectURL(i))},E=i=>D(i.target.files?.[0]||null),z=i=>D(i.dataTransfer?.files[0]||null),K=()=>{l.image=null,m.value=null,_.value&&(_.value.value="")},L=i=>u.value=i,q=()=>C.value?.click(),A=i=>{const t=i.target.files?.[0]||null;t&&(p.value=t,d.value=null,c.value="")},$=()=>{p.value=null,d.value=null,c.value="",C.value&&(C.value.value="")},T=i=>{const t=P.value;if(!t)return;const a=t.selectionStart,b=t.selectionEnd,v=t.value.substring(a,b);let x="";switch(i){case"bold":x=`**${v}**`;break;case"italic":x=`*${v}*`;break;case"heading":const G=t.value.lastIndexOf(`
`,a-1)+1;x=`## ${t.value.substring(G,b)}`,t.setSelectionRange(G,b);break;case"list":x=v.split(`
`).map(W=>`- ${W}`).join(`
`);break}t.setRangeText(x,t.selectionStart,t.selectionEnd,"end"),l.description=t.value,t.focus()};et(async()=>{try{const i=await F(`/api/v2/products?id=${V}`);if(!i.status)throw new Error(i.msg);const t=i.data;if(Object.assign(l,t),l.show=String(t.show),m.value=t.imageUrl,t.file&&(d.value=t.file,t.file.type==="cloud"?(u.value="url",c.value=t.file.data):u.value="upload"),t.additional_information&&typeof t.additional_information=="string")try{l.additional_information=JSON.parse(t.additional_information)}catch{l.additional_information=[]}else t.additional_information||(l.additional_information=[])}catch(i){await S.fire({icon:"error",title:"Gagal Memuat Data",text:i.message||"Tidak dapat mengambil data produk.",confirmButtonText:"Kembali"}).then(()=>{B.push("/dashboard")})}finally{I.value=!1}});const J=async()=>{if(g.value=!0,!l.name||!l.price){S.fire("Input Tidak Lengkap","Nama dan harga produk wajib diisi.","warning"),g.value=!1;return}const i=new FormData;i.append("id",V),i.append("type","edit"),i.append("name",l.name),i.append("description",l.description||""),i.append("price",String(l.price)),i.append("original_price",String(l.original_price||"")),i.append("label",l.label||""),i.append("show",l.show),i.append("stock_available",String(l.stock_available));const t=l.additional_information?.filter(a=>a.name.trim())||[];i.append("additional_information",JSON.stringify(t)),l.image&&i.append("image",l.image),p.value?(i.append("file",p.value),i.append("file_upload_destination",y.value)):u.value==="url"?c.value!==d.value?.data&&i.append("file_url",c.value):d.value||i.append("file","");try{const a=await F("/api/v2/product",{method:"POST",body:i});if(!a.status)throw new Error(a.msg);await S.fire({icon:"success",title:"Berhasil!",text:"Produk telah diperbarui.",timer:2e3,showConfirmButton:!1})}catch(a){S.fire({icon:"error",title:"Update Gagal",text:`Terjadi kesalahan: ${a.message}`})}finally{g.value=!1}};return(i,t)=>(s(),o("div",nt,[I.value?(s(),o("div",rt,t[17]||(t[17]=[e("div",{class:"spinner-border product-loader-spinner",role:"status"},null,-1),e("p",{class:"ms-3 mb-0"},"Loading...",-1)]))):l._id?(s(),o("div",dt,[e("form",{onSubmit:k(J,["prevent"])},[e("div",ut,[e("div",pt,[e("div",ct,[t[18]||(t[18]=e("label",{for:"productName",class:"form-label"},"Nama Produk",-1)),r(e("input",{type:"text",class:"form-control",id:"productName","onUpdate:modelValue":t[0]||(t[0]=a=>l.name=a),required:""},null,512),[[f,l.name]])]),e("div",mt,[t[23]||(t[23]=e("label",{for:"productDescription",class:"form-label"},"Deskripsi (Markdown)",-1)),e("div",bt,[e("button",{type:"button",onClick:t[1]||(t[1]=a=>T("bold")),title:"Bold (Ctrl+B)"},t[19]||(t[19]=[e("i",{class:"bi bi-type-bold"},null,-1)])),e("button",{type:"button",onClick:t[2]||(t[2]=a=>T("italic")),title:"Italic (Ctrl+I)"},t[20]||(t[20]=[e("i",{class:"bi bi-type-italic"},null,-1)])),e("button",{type:"button",onClick:t[3]||(t[3]=a=>T("heading")),title:"Heading"},t[21]||(t[21]=[e("i",{class:"bi bi-type-h2"},null,-1)])),e("button",{type:"button",onClick:t[4]||(t[4]=a=>T("list")),title:"Unordered List"},t[22]||(t[22]=[e("i",{class:"bi bi-list-ul"},null,-1)]))]),r(e("textarea",{class:"form-control editor-textarea",id:"productDescription",rows:"8","onUpdate:modelValue":t[5]||(t[5]=a=>l.description=a),ref_key:"descriptionTextarea",ref:P,required:""},null,512),[[f,l.description]])]),e("div",vt,[e("div",ft,[t[24]||(t[24]=e("label",{for:"productPrice",class:"form-label"},"Harga",-1)),r(e("input",{type:"number",class:"form-control",id:"productPrice","onUpdate:modelValue":t[6]||(t[6]=a=>l.price=a),required:""},null,512),[[f,l.price]])]),e("div",kt,[t[25]||(t[25]=e("label",{for:"original_price",class:"form-label"},"Harga Asli (Opsional)",-1)),r(e("input",{type:"number",class:"form-control",id:"original_price","onUpdate:modelValue":t[7]||(t[7]=a=>l.original_price=a),placeholder:"Contoh: 500000"},null,512),[[f,l.original_price]])]),e("div",gt,[t[27]||(t[27]=e("label",{for:"productTag",class:"form-label"},"Tag (Opsional)",-1)),r(e("select",{class:"form-select",id:"productTag","onUpdate:modelValue":t[8]||(t[8]=a=>l.label=a)},t[26]||(t[26]=[e("option",{value:""},"-- Tidak ada tag --",-1),e("option",{value:"Baru"},"Baru",-1),e("option",{value:"Populer"},"Populer",-1),e("option",{value:"Diskon"},"Diskon",-1)]),512),[[N,l.label]])]),e("div",yt,[t[29]||(t[29]=e("label",{for:"productVisibility",class:"form-label"},"Visibilitas",-1)),r(e("select",{class:"form-select",id:"productVisibility","onUpdate:modelValue":t[9]||(t[9]=a=>l.show=a)},t[28]||(t[28]=[e("option",{value:"true"},"Tampilkan",-1),e("option",{value:"false"},"Sembunyikan",-1)]),512),[[N,l.show]])])]),e("div",xt,[t[30]||(t[30]=e("label",{class:"form-label d-block"},"Ketersediaan Stok",-1)),e("div",wt,[r(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"stockSwitch","onUpdate:modelValue":t[10]||(t[10]=a=>l.stock_available=a)},null,512),[[it,l.stock_available]]),e("label",_t,w(l.stock_available?"Stok Tersedia":"Stok Habis"),1)])])]),e("div",Ct,[t[33]||(t[33]=e("label",{class:"form-label"},"Gambar Produk",-1)),m.value?(s(),o("div",Tt,[e("img",{src:m.value,alt:"Preview Gambar Produk",class:"img-preview"},null,8,ht)])):h("",!0),e("div",{class:"image-upload-box text-center",onClick:R,onDragover:t[11]||(t[11]=k(()=>{},["prevent"])),onDrop:k(z,["prevent"])},[l.image||m.value?(s(),o("div",St,[t[31]||(t[31]=e("i",{class:"bi bi-file-earmark-image-fill upload-icon text-success"},null,-1)),e("p",{class:"mb-0 text-truncate px-2",title:l.image?.name},w(l.image?.name||"Gambar saat ini"),9,Ut),e("button",{type:"button",class:"btn btn-sm btn-outline-danger mt-2",onClick:k(K,["stop"])},"Ganti Gambar")])):(s(),o("div",Ft,t[32]||(t[32]=[e("i",{class:"bi bi-cloud-arrow-up-fill upload-icon"},null,-1),e("p",{class:"text-secondary small"},"Klik atau seret gambar baru",-1)])))],32),e("input",{type:"file",ref_key:"imageFileInput",ref:_,onChange:E,accept:"image/*",class:"d-none"},null,544)])]),t[46]||(t[46]=e("hr",{class:"my-4"},null,-1)),e("div",It,[t[41]||(t[41]=e("h5",{class:"mb-3"},"File Produk (Opsional)",-1)),e("ul",Pt,[e("li",Vt,[e("button",{class:O(["nav-link",{active:u.value==="upload"}]),type:"button",onClick:t[12]||(t[12]=a=>L("upload"))},"Upload File",2)]),e("li",Dt,[e("button",{class:O(["nav-link",{active:u.value==="url"}]),type:"button",onClick:t[13]||(t[13]=a=>L("url"))},"Gunakan URL",2)])]),e("div",Lt,[u.value==="upload"?(s(),o("div",$t,[e("div",Gt,[t[36]||(t[36]=e("label",{class:"form-label small"},"Tujuan Upload : Â ",-1)),e("div",Nt,[r(e("input",{class:"form-check-input",type:"radio",id:"uploadLocal",value:"local","onUpdate:modelValue":t[14]||(t[14]=a=>y.value=a)},null,512),[[j,y.value]]),t[34]||(t[34]=e("label",{class:"form-check-label",for:"uploadLocal"},"Local",-1))]),e("div",Ot,[r(e("input",{class:"form-check-input",type:"radio",id:"uploadCloud",value:"cloud","onUpdate:modelValue":t[15]||(t[15]=a=>y.value=a)},null,512),[[j,y.value]]),t[35]||(t[35]=e("label",{class:"form-check-label",for:"uploadCloud"},"Cloud",-1))])]),e("div",{class:"image-upload-box text-center",onClick:q},[p.value?(s(),o("div",jt,[t[37]||(t[37]=e("i",{class:"bi bi-file-zip-fill upload-icon text-success"},null,-1)),e("p",{class:"mb-0 text-truncate px-2",title:p.value.name},w(p.value.name),9,Bt),e("button",{type:"button",class:"btn btn-sm btn-outline-danger mt-2",onClick:k($,["stop"])},"Ganti File")])):d.value?(s(),o("div",Ht,[t[38]||(t[38]=e("i",{class:"bi bi-file-earmark-check-fill upload-icon text-success"},null,-1)),e("p",{class:"mb-0 text-truncate px-2",title:d.value.data},"File saat ini: "+w(d.value.data.split("/").pop()),9,Mt),e("p",Rt,"("+w(d.value.size)+")",1),e("button",{type:"button",class:"btn btn-sm btn-outline-danger mt-2",onClick:k($,["stop"])},"Hapus File")])):(s(),o("div",Et,t[39]||(t[39]=[e("i",{class:"bi bi-cloud-arrow-up-fill upload-icon"},null,-1),e("p",{class:"text-secondary small"},"Klik atau seret file",-1)])))]),e("input",{type:"file",ref_key:"productFileInput",ref:C,onChange:A,class:"d-none"},null,544)])):h("",!0),u.value==="url"?(s(),o("div",zt,[t[40]||(t[40]=e("label",{for:"fileUrl",class:"form-label"},"Link File Produk",-1)),r(e("input",{type:"url",class:"form-control",id:"fileUrl","onUpdate:modelValue":t[16]||(t[16]=a=>c.value=a),placeholder:"https://contoh.com/file.zip"},null,512),[[f,c.value]])])):h("",!0)])]),t[47]||(t[47]=e("hr",{class:"my-4"},null,-1)),e("div",Kt,[t[44]||(t[44]=e("h5",{class:"mb-3"},"Informasi Tambahan dari Pembeli",-1)),t[45]||(t[45]=e("p",{class:"small"},"Tentukan label input yang harus diisi oleh pembeli saat checkout.",-1)),(s(!0),o(at,null,ot(l.additional_information,(a,b)=>(s(),o("div",{key:b,class:"row g-2 mb-2 align-items-center"},[e("div",qt,[r(e("input",{type:"text",class:"form-control","onUpdate:modelValue":v=>a.name=v,placeholder:"Nama Label (Contoh: ID Game)"},null,8,At),[[f,a.name]])]),e("div",Jt,[e("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:v=>M(b),title:"Hapus Label"},t[42]||(t[42]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Wt)])]))),128)),e("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:H},t[43]||(t[43]=[e("i",{class:"bi bi-plus-circle"},null,-1),st(" Tambah Label",-1)]))]),e("div",Qt,[e("button",{type:"submit",class:"btn btn-custom-accent btn-lg",disabled:g.value},[g.value?(s(),o("span",Yt)):(s(),o("span",Zt,"Update Produk"))],8,Xt)])],32)])):h("",!0)]))}});export{oe as default};
