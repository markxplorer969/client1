import{k as U,E as V,r as c,i as w,l as G,c as i,o,b as s,w as k,v as M,t as e,f as N,j as C,F as P,m as I,n as D,y as J,z as q,d as z,u as F,A as B}from"./a6n2H657.js";import{a as E,b as H}from"./Dh1ThmVH.js";import{u as O}from"./TrFBJUAx.js";const Q={class:"d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3"},K={class:"d-flex"},W={key:0,class:"d-flex justify-content-center align-items-center py-5"},X={key:1,class:"content-card text-center p-5 text-danger"},Y={class:"text-secondary"},Z={key:2},ss={class:"row g-4 mb-4"},ts={class:"col-lg-6 col-md-6"},as={class:"content-card stat-card"},es={class:"text-content"},ns={class:"value"},ls={class:"col-lg-6 col-md-6"},os={class:"content-card stat-card"},is={class:"text-content"},ds={class:"value"},rs={class:"col-lg-6 col-md-6"},cs={class:"content-card stat-card"},us={class:"text-content"},vs={class:"value"},ms={class:"col-lg-6 col-md-6"},ps={class:"content-card stat-card"},bs={class:"text-content"},_s={class:"value"},gs={class:"row g-4"},hs={class:"col-lg-8"},fs={class:"content-card"},ks={class:"table-responsive"},ys={class:"app-table"},$s={key:0},xs={class:"text-secondary fw-bold"},ws={class:"text-secondary"},Cs={class:"text-end fw-bold"},Ps={class:"text-center"},Ds=["onClick"],Ts={class:"card-footer"},Ls={class:"search-container"},Ss={key:0,class:"pagination-container"},js={class:"pagination"},As={class:"page-item pagination-summary"},Ns={class:"page-link"},Is={class:"col-lg-4"},Ms={class:"content-card"},Rs={class:"list-group list-group-flush"},Bs={key:0,class:"list-group-item text-center text-secondary py-4"},Es={class:"d-flex align-items-center"},Us={class:"top-product-rank me-3"},Vs={class:"d-flex flex-column"},Gs={class:"fw-bold top-product-name"},Js={class:"text-secondary"},qs=["onClick"],zs={__name:"DashboardAdmin",setup(R){const{$api:T}=U(),j=V(),g=c(!0),p=c(null),m=c({totalRevenue:0,totalSales:0,totalProducts:0,newCustomers:0}),h=c([]),y=c([]),f=c(""),u=c(1),v=c(5),$=w(()=>{if(!f.value)return h.value;const d=f.value.toLowerCase();return h.value.filter(t=>t.productName.toLowerCase().includes(d))}),b=w(()=>Math.ceil($.value.length/v.value)),_=w(()=>{u.value>b.value&&b.value>0&&(u.value=1);const d=(u.value-1)*v.value,t=d+v.value;return $.value.slice(d,t)}),A=d=>{j.push(`/invoice/${d}`)},L=async()=>{g.value=!0,p.value=null;try{const d=await T("/api/v2/statistic");if(d?.status&&d.data){const{stats:t,recentSales:r,topProducts:n}=d.data;m.value=t,h.value=r,y.value=n}else throw new Error(d.msg||"Gagal memuat data")}catch(d){p.value=d.message||"Terjadi kesalahan saat menghubungi server"}finally{g.value=!1}},x=d=>{d>=1&&d<=b.value&&(u.value=d)};return G(L),(d,t)=>(o(),i(P,null,[s("div",Q,[t[7]||(t[7]=s("h1",{class:"fw-bold mb-0"},"Selamat datang Admin!",-1)),s("div",K,[s("a",{onClick:t[0]||(t[0]=k(r=>d.$router.push("/dashboard/products"),["prevent"])),class:"btn btn-outline-primary me-2"},t[5]||(t[5]=[s("i",{class:"bi bi-list-ul me-2"},null,-1),M("List Produk ",-1)])),s("a",{onClick:t[1]||(t[1]=k(r=>d.$router.push("/dashboard/add-product"),["prevent"])),class:"btn btn-custom-accent"},t[6]||(t[6]=[s("i",{class:"bi bi-plus-lg me-2"},null,-1),M("Tambah Produk ",-1)]))])]),g.value?(o(),i("div",W,t[8]||(t[8]=[s("div",{class:"spinner-border product-loader-spinner",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),s("p",{class:"ms-3 mb-0"},"Loading...",-1)]))):p.value?(o(),i("div",X,[t[9]||(t[9]=s("i",{class:"bi bi-exclamation-triangle-fill display-4 mb-3"},null,-1)),t[10]||(t[10]=s("h5",{class:"fw-bold"},"Gagal Memuat Data",-1)),s("p",Y,e(p.value),1),s("button",{onClick:L,class:"btn btn-custom-accent mt-3"},"Coba Lagi")])):(o(),i("div",Z,[s("div",ss,[s("div",ts,[s("div",as,[t[12]||(t[12]=s("i",{class:"bi bi-cash-stack icon"},null,-1)),s("div",es,[t[11]||(t[11]=s("div",{class:"label"},"Total Pendapatan",-1)),s("div",ns,"Rp "+e(N(E)(m.value.totalRevenue)),1)])])]),s("div",ls,[s("div",os,[t[14]||(t[14]=s("i",{class:"bi bi-cart-check icon"},null,-1)),s("div",is,[t[13]||(t[13]=s("div",{class:"label"},"Total Penjualan",-1)),s("div",ds,e(m.value.totalSales)+" Unit",1)])])]),s("div",rs,[s("div",cs,[t[16]||(t[16]=s("i",{class:"bi bi-box-seam icon"},null,-1)),s("div",us,[t[15]||(t[15]=s("div",{class:"label"},"Jumlah Produk",-1)),s("div",vs,e(m.value.totalProducts),1)])])]),s("div",ms,[s("div",ps,[t[18]||(t[18]=s("i",{class:"bi bi-person-add icon"},null,-1)),s("div",bs,[t[17]||(t[17]=s("div",{class:"label"},"Pelanggan Baru (30 Hari)",-1)),s("div",_s,e(m.value.newCustomers),1)])])])]),s("div",gs,[s("div",hs,[s("div",fs,[t[23]||(t[23]=s("div",{class:"card-header"},[s("h5",{class:"fw-bold mb-0"},"Transaksi Terbaru")],-1)),s("div",ks,[s("table",ys,[t[21]||(t[21]=s("thead",null,[s("tr",null,[s("th",null,"ID"),s("th",null,"Produk"),s("th",null,"Tanggal"),s("th",null,"Status"),s("th",{class:"text-end"},"Jumlah"),s("th",{class:"text-center"},"Aksi")])],-1)),s("tbody",null,[_.value.length===0?(o(),i("tr",$s,t[19]||(t[19]=[s("td",{colspan:"6",class:"text-center text-secondary py-4"}," Tidak ada transaksi yang cocok dengan pencarian Anda. ",-1)]))):C("",!0),(o(!0),i(P,null,I(_.value,r=>(o(),i("tr",{key:r.id},[s("td",xs,"#"+e(r.id),1),s("td",null,e(r.productName),1),s("td",ws,e(N(H)(r.date)),1),s("td",null,[s("span",{class:D(["status-badge",`status-${r.status.toLowerCase()}`])},e(r.status),3)]),s("td",Cs,"Rp "+e(N(E)(r.amount)),1),s("td",Ps,[s("button",{onClick:n=>A(r.id),class:"btn btn-sm btn-action-view",title:"Lihat Detail"},t[20]||(t[20]=[s("i",{class:"bi bi-eye-fill"},null,-1)]),8,Ds)])]))),128))])])]),s("div",Ts,[s("div",Ls,[t[22]||(t[22]=s("i",{class:"bi bi-search search-icon"},null,-1)),J(s("input",{type:"search","onUpdate:modelValue":t[2]||(t[2]=r=>f.value=r),class:"form-control search-input",placeholder:"Cari transaksi berdasarkan produk..."},null,512),[[q,f.value]])]),b.value>1?(o(),i("nav",Ss,[s("ul",js,[s("li",{class:D(["page-item",{disabled:u.value===1}])},[s("a",{class:"page-link",href:"#",onClick:t[3]||(t[3]=k(r=>x(u.value-1),["prevent"]))},"Prev")],2),s("li",As,[s("span",Ns,e(u.value)+" / "+e(b.value),1)]),s("li",{class:D(["page-item",{disabled:u.value===b.value}])},[s("a",{class:"page-link",href:"#",onClick:t[4]||(t[4]=k(r=>x(u.value+1),["prevent"]))},"Next")],2)])])):C("",!0)])])]),s("div",Is,[s("div",Ms,[t[25]||(t[25]=s("div",{class:"card-header"},[s("h5",{class:"fw-bold mb-0"},"Produk Terlaris")],-1)),s("ul",Rs,[y.value.length===0?(o(),i("li",Bs," Data penjualan belum cukup. ")):C("",!0),(o(!0),i(P,null,I(y.value,(r,n)=>(o(),i("li",{key:r.id,class:"list-group-item d-flex justify-content-between align-items-center"},[s("div",Es,[s("span",Us,e(n+1),1),s("div",Vs,[s("span",Gs,e(r.name),1),s("small",Js,e(r.sales)+" Penjualan",1)])]),s("a",{onClick:k(a=>d.$router.push(`/product/${r.id}`),["prevent"]),class:"btn btn-sm btn-action-view",title:"Lihat Produk"},t[24]||(t[24]=[s("i",{class:"bi bi-eye"},null,-1)]),8,qs)]))),128))])])])])]))],64))}},Fs={class:"d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3"},Hs={key:0,class:"fw-bold mb-0"},Os={key:1,class:"fw-bold mb-0"},Qs={key:0,class:"d-flex justify-content-center align-items-center py-5"},Ks={key:1,class:"content-card text-center p-5 text-danger"},Ws={class:"text-secondary"},Xs={key:2},Ys={class:"row g-4 mb-4"},Zs={class:"col-lg-6 col-md-6"},st={class:"content-card stat-card"},tt={class:"text-content"},at={class:"value"},et={class:"col-lg-6 col-md-6"},nt={class:"content-card stat-card"},lt={class:"text-content"},ot={class:"value"},it={class:"col-lg-6 col-md-6"},dt={class:"content-card stat-card"},rt={class:"text-content"},ct={class:"value"},ut={class:"col-lg-6 col-md-6"},vt={class:"content-card stat-card"},mt={class:"text-content"},pt={class:"value"},bt={class:"row g-4"},_t={class:"col-lg-8"},gt={class:"content-card"},ht={class:"table-responsive"},ft={class:"app-table"},kt={key:0},yt={class:"text-secondary fw-bold"},$t={class:"text-secondary"},xt={class:"text-end fw-bold"},wt={class:"text-center"},Ct=["onClick"],Pt={class:"card-footer"},Dt={class:"search-container"},Tt={key:0,class:"pagination-container"},Lt={class:"pagination"},St={class:"page-item pagination-summary"},jt={class:"page-link"},At={class:"col-lg-4"},Nt={class:"content-card"},It={class:"list-group list-group-flush"},Mt={key:0,class:"list-group-item text-center text-secondary py-4"},Rt={class:"d-flex align-items-center"},Bt={class:"d-flex flex-column"},Et={class:"fw-bold top-product-name"},Ut={class:"text-secondary"},Vt={__name:"DashboardUser",setup(R){const{$api:T}=U(),j=V(),g=c(!0),p=c(null),m=c({}),h=c({}),y=c([]),f=c([]),u=c(""),v=c(1),$=c(5),b=w(()=>{if(!u.value)return y.value;const n=u.value.toLowerCase();return y.value.filter(a=>a.productName.toLowerCase().includes(n))}),_=w(()=>Math.ceil(b.value.length/$.value)),A=w(()=>{v.value>_.value&&_.value>0&&(v.value=1);const n=(v.value-1)*$.value,a=n+$.value;return b.value.slice(n,a)}),L=n=>Number(n||0).toLocaleString("id-ID"),x=n=>new Date(n).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}),d=n=>{n>=1&&n<=_.value&&(v.value=n)},t=n=>{j.push(`/invoice/${n}`)},r=async()=>{g.value=!0,p.value=null;try{const n=await T("/api/v1/statistic");if(!n.status||!n.data)throw new Error(n.msg||"Gagal mengambil data dari server.");const a=n.data;m.value={name:a.name,registrationDate:a.joinedAt},h.value={totalSpending:a.stats.totalPurchase,totalTransactions:a.stats.totalTransactions,productsOwned:a.stats.totalItems},y.value=a.transactions.map(l=>({id:l._id,productName:l.items.map(S=>S.name).join(", "),date:l.created_at,status:l.status,amount:l.amount})),f.value=a.transactions.filter(l=>l.status==="Paid").flatMap(l=>l.items.map(S=>({id:`${l._id}-${S.name}`,name:S.name,purchaseDate:l.created_at,downloadLink:"#"})))}catch(n){console.error("Error fetching dashboard data:",n),p.value=n.message||"Terjadi kesalahan saat memuat data."}finally{g.value=!1}};return G(r),(n,a)=>(o(),i(P,null,[s("div",Fs,[m.value.name?(o(),i("h1",Hs,"Selamat Datang, "+e(m.value.name)+"!",1)):(o(),i("h1",Os,"Dasbor Anda")),s("a",{onClick:a[0]||(a[0]=k(l=>n.$router.push("/products"),["prevent"])),class:"btn btn-custom-accent"},a[4]||(a[4]=[s("i",{class:"bi bi-shop me-2"},null,-1),M("Telusuri Produk ",-1)]))]),g.value?(o(),i("div",Qs,a[5]||(a[5]=[s("div",{class:"spinner-border product-loader-spinner",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),s("p",{class:"ms-3 mb-0"},"Loading...",-1)]))):p.value?(o(),i("div",Ks,[a[6]||(a[6]=s("i",{class:"bi bi-exclamation-triangle-fill display-4 mb-3"},null,-1)),a[7]||(a[7]=s("h5",{class:"fw-bold"},"Gagal Memuat Data",-1)),s("p",Ws,e(p.value),1),s("button",{onClick:r,class:"btn btn-custom-accent mt-3"},"Coba Lagi")])):(o(),i("div",Xs,[s("div",Ys,[s("div",Zs,[s("div",st,[a[9]||(a[9]=s("i",{class:"bi bi-wallet2 icon"},null,-1)),s("div",tt,[a[8]||(a[8]=s("div",{class:"label"},"Total Belanja",-1)),s("div",at,"Rp "+e(L(h.value.totalSpending)),1)])])]),s("div",et,[s("div",nt,[a[11]||(a[11]=s("i",{class:"bi bi-receipt-cutoff icon"},null,-1)),s("div",lt,[a[10]||(a[10]=s("div",{class:"label"},"Total Transaksi",-1)),s("div",ot,e(h.value.totalTransactions)+" Transaksi",1)])])]),s("div",it,[s("div",dt,[a[13]||(a[13]=s("i",{class:"bi bi-box-seam icon"},null,-1)),s("div",rt,[a[12]||(a[12]=s("div",{class:"label"},"Produk Dimiliki",-1)),s("div",ct,e(h.value.productsOwned)+" Produk",1)])])]),s("div",ut,[s("div",vt,[a[15]||(a[15]=s("i",{class:"bi bi-calendar-check icon"},null,-1)),s("div",mt,[a[14]||(a[14]=s("div",{class:"label"},"Member Sejak",-1)),s("div",pt,e(x(m.value.registrationDate)),1)])])])]),s("div",bt,[s("div",_t,[s("div",gt,[a[20]||(a[20]=s("div",{class:"card-header"},[s("h5",{class:"fw-bold mb-0"},"Riwayat Transaksi")],-1)),s("div",ht,[s("table",ft,[a[18]||(a[18]=s("thead",null,[s("tr",null,[s("th",null,"ID Transaksi"),s("th",null,"Produk"),s("th",null,"Tanggal"),s("th",null,"Status"),s("th",{class:"text-end"},"Jumlah"),s("th",{class:"text-center"},"Aksi")])],-1)),s("tbody",null,[A.value.length===0?(o(),i("tr",kt,a[16]||(a[16]=[s("td",{colspan:"6",class:"text-center text-secondary py-4"}," Tidak ada transaksi. ",-1)]))):C("",!0),(o(!0),i(P,null,I(A.value,l=>(o(),i("tr",{key:l.id},[s("td",yt,"#"+e(l.id),1),s("td",null,e(l.productName),1),s("td",$t,e(x(l.date)),1),s("td",null,[s("span",{class:D(["status-badge",`status-${l.status.toLowerCase()}`])},e(l.status),3)]),s("td",xt,"Rp "+e(L(l.amount)),1),s("td",wt,[s("button",{onClick:S=>t(l.id),class:"btn btn-sm btn-action-view",title:"Lihat Detail"},a[17]||(a[17]=[s("i",{class:"bi bi-eye-fill"},null,-1)]),8,Ct)])]))),128))])])]),s("div",Pt,[s("div",Dt,[a[19]||(a[19]=s("i",{class:"bi bi-search search-icon"},null,-1)),J(s("input",{type:"search","onUpdate:modelValue":a[1]||(a[1]=l=>u.value=l),class:"form-control search-input",placeholder:"Cari transaksi berdasarkan produk..."},null,512),[[q,u.value]])]),_.value>1?(o(),i("nav",Tt,[s("ul",Lt,[s("li",{class:D(["page-item",{disabled:v.value===1}])},[s("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=k(l=>d(v.value-1),["prevent"]))},"Prev")],2),s("li",St,[s("span",jt,e(v.value)+" / "+e(_.value),1)]),s("li",{class:D(["page-item",{disabled:v.value===_.value}])},[s("a",{class:"page-link",href:"#",onClick:a[3]||(a[3]=k(l=>d(v.value+1),["prevent"]))},"Next")],2)])])):C("",!0)])])]),s("div",At,[s("div",Nt,[a[22]||(a[22]=s("div",{class:"card-header"},[s("h5",{class:"fw-bold mb-0"},"Produk")],-1)),s("ul",It,[f.value.length===0?(o(),i("li",Mt," Anda belum membeli produk apapun. ")):C("",!0),(o(!0),i(P,null,I(f.value,l=>(o(),i("li",{key:l.id,class:"list-group-item d-flex justify-content-between align-items-center"},[s("div",Rt,[a[21]||(a[21]=s("i",{class:"bi bi-box-seam me-3 fs-4 text-secondary"},null,-1)),s("div",Bt,[s("span",Et,e(l.name),1),s("small",Ut,"Dibeli pada: "+e(x(l.purchaseDate)),1)])])]))),128))])])])])]))],64))}},Gt={class:"container px-3 mb-4"},Ft=z({__name:"index",setup(R){const{type:T}=O();return F({title:"Dashboard"}),(j,g)=>{const p=zs,m=Vt;return o(),i("div",Gt,[N(T)==="admin"?(o(),B(p,{key:0})):(o(),B(m,{key:1}))])}}});export{Ft as default};
