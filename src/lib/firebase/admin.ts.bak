import 'server-only';

import { getApps, initializeApp, cert } from 'firebase-admin/app';
import { getFirestore, FieldValue } from 'firebase-admin/firestore';
import { getAuth } from 'firebase-admin/auth';
import { getStorage } from 'firebase-admin/storage';
import { firebaseAdminConfig } from './config';

// Logic inisialisasi App yang lebih robust
let app;

if (!getApps().length) {
  app = initializeApp({
    credential: cert(firebaseAdminConfig),
    storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  });
} else {
  app = getApps()[0];
}

// Inisialisasi service
const db = getFirestore(app);
const adminAuth = getAuth(app); // Menggunakan nama 'adminAuth' agar match dengan import file lain
const storage = getStorage(app);

// Export lengkap sesuai kebutuhan file lain
export { app, db, adminAuth, storage, FieldValue };